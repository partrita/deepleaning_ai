import math

import wget

db_list = """
ALL_GSE132509
AML_GSE116256
AML_GSE147989
BCC_GSE123813_aPD1
BLCA_GSE130001
BLCA_GSE145281_aPDL1
BRCA_GSE110686
BRCA_GSE114727_10X
BRCA_GSE114727_inDrop
BRCA_GSE136206_mouse_aPD1aCTLA4
BRCA_GSE138536
BRCA_GSE143423
BRCA_GSE176078
BRCA_SRP114962
CHOL_GSE125449_aPD1aPDL1aCTLA4
CLL_GSE111014
CLL_GSE125881
CRC_GSE108989
CRC_GSE112865_mouse_aPD1
CRC_GSE120909_mouse_aPD1
CRC_GSE122969_mouse_aPD1aTIM3
CRC_GSE136394
CRC_GSE139555
CRC_GSE146771_10X
CRC_GSE146771_Smartseq2
Glioma_GSE102130
Glioma_GSE103224
Glioma_GSE131928_10X
Glioma_GSE131928_Smartseq2
Glioma_GSE135437
Glioma_GSE138794
Glioma_GSE139448
Glioma_GSE141982
Glioma_GSE148842
Glioma_GSE70630
Glioma_GSE84465
Glioma_GSE89567
HNSC_GSE103322
HNSC_GSE139324
KIRC_GSE111360
KIRC_GSE139555
KIRC_GSE145281_aPDL1
LIHC_GSE125449_aPDL1aCTLA4
LIHC_GSE140228_10X
LIHC_GSE140228_Smartseq2
LIHC_GSE98638
MB_GSE119926
MCC_GSE117988_aPD1aCTLA4
MCC_GSE118056_aPDL1
MM_GSE117156
MM_GSE141299
NET_GSE140312
NHL_GSE128531
NSCLC_EMTAB6149
NSCLC_GSE117570
NSCLC_GSE127465
NSCLC_GSE127471
NSCLC_GSE131907
NSCLC_GSE139555
NSCLC_GSE143423
NSCLC_GSE99254
OV_GSE115007
OV_GSE118828
PAAD_CRA001160
PAAD_GSE111672
PBMC_30K
PBMC_60K
PBMC_8K
SARC_GSE119352_mouse_aPD1aCTLA4
SCC_GSE123813_aPD1
SKCM_GSE115978_aPD1
SKCM_GSE120575_aPD1aCTLA4
SKCM_GSE123139
SKCM_GSE139249
SKCM_GSE148190
SKCM_GSE72056
STAD_GSE134520
UCEC_GSE139555
UVM_GSE139829
CLL_GSE152469
ALL_GSE153697
ALL_GSE154109
AML_GSE135851
AML_GSE154109
BCC_GSE141526
BLCA_GSE149652
BRCA_EMTAB8107
BRCA_GSE148673
BRCA_GSE150660
BRCA_GSE161529
CESC_GSE168652
CHOL_GSE138709
CHOL_GSE142784
CLL_GSE132065
CLL_GSE142744
CLL_GSE159417
CRC_EMTAB8107
CRC_GSE166555
CRC_GSE179784
ESCA_GSE154763
ESCA_GSE160269
ESCA_GSE173950
GCTB_GSE168664
Glioma_GSE141383
Glioma_GSE141460
Glioma_GSE162631
Glioma_GSE163108_10X
Glioma_GSE163108_Smartseq2
LSCC_GSE150321
NPC_GSE150430
NPC_GSE162025
OSCC_GSE172577
HNSC_GSE180268
KICH_GSE159115
KIPAN_GSE154763
KIPAN_GSE159913
KIRC_GSE121636
KIRC_GSE159115
KIRC_GSE171306
LIHC_GSE146115
LIHC_GSE146409
LIHC_GSE166635
LIHC_GSE179795
HB_GSE180665
MB_GSE155446
MM_GSE143317
MM_GSE151310
MM_GSE154763
MM_GSE161801
MM_GSE164551
MM_GSE175385
NB_GSE154037
NHL_GSE147944
MF_GSE165623
PCFCL_GSE173820
MF_GSE173820
DLBC_GSE175510
NSCLC_GSE146100
NSCLC_GSE148071
NSCLC_GSE149655
NSCLC_GSE150660
NSCLC_GSE151537
NSCLC_GSE153935
NSCLC_GSE162498
NSCLC_GSE176021_aPD1
NSCLC_GSE179373
OS_GSE162454
OV_EMTAB8107
OV_GSE130000
OV_GSE147082
OV_GSE151214
OV_GSE154600
OV_GSE154763
OV_GSE158722
PAAD_GSE141017
PAAD_GSE148673
PAAD_GSE154763
PAAD_GSE154778
PAAD_GSE158356
PAAD_GSE162708
PAAD_GSE165399
PRAD_GSE176031
Neurofibroma_GSE163028
MPNST_GSE165826
PRAD_GSE137829
PRAD_GSE141445
PRAD_GSE143791
PRAD_GSE150692
PRAD_GSE172301
RB_GSE166173
SS_GSE131309_10X
SS_GSE131309_Smartseq2
GIST_GSE162115
PPB_GSE163678
SCC_GSE144236
SCLC_GSE150766
SKCM_GSE134388_aPD1
SKCM_GSE159251
SKCM_GSE166181_aPD1
SKCM_GSE179373
STAD_GSE167297
THCA_GSE148673
THCA_GSE154763
THCA_GSE163203
UCEC_GSE154763
UVM_GSE138433
UVM_GSE160883
UVM_GSE169609
SCC_GSE145328
"""

db_list = db_list.split()


def bar_custom(current, total, width=80):
    width = 30
    avail_dots = width - 2
    shaded_dots = int(math.floor(float(current) / total * avail_dots))
    percent_bar = "[" + "â– " * shaded_dots + " " * (avail_dots - shaded_dots) + "]"
    progress = f"{int(current / total * 100)}% {percent_bar} [{current}/{total}]"

    return progress


def download(url, out_path="../output/tish2db/"):
    wget.download(url, out=out_path, bar=bar_custom)


for i in db_list:
    try:
        url = (
            f"http://tisch.comp-genomics.org/static/data/{i}/{i}_CellMetainfo_table.tsv"
        )
        download(url)
        print(f" <- Meta data of {i} is download in input folder")
    except BaseException:
        print(f" <- There is error in {i}")

for i in db_list:
    try:
        url = f"https://biostorage.s3.ap-northeast-2.amazonaws.com/TISCH_2022/{i}/{i}_expression.h5"
        download(url)
        print(f" <- Meta data of {i} is download in input folder")
    except BaseException:
        print(f" <- There is error in {i}")
